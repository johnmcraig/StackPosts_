@page "/replies/create"

@inject IPostService PostService
@inject HttpClient Http
@inject NavigationManager NavManager

<EditForm Model="ReplyModel" OnValidSubmit="CreateReply">
  <DataAnnotationsValidator />

  <ValidationSummary />

    <div class="form-group">
      <label>Your Reply:</label>
      <InputTextArea @bind-Value="ReplyModel.Body" class="form-control" placeholder="Enter your reply here..." />
    </div>

    <button class="btn btn-primary" type="submit">Submit</button>
    <button class="btn btn-secondary" type="reset" @onclick="BackToList">Cancel</button>
</EditForm>

@code {

    [Parameter]
    public int Id { get; set; }

    private ReplyModel ReplyModel = new ReplyModel();
    private PostModel PostModel = new PostModel();

    protected override async Task OnInitializedAsync()
    {
        PostModel = await PostService.GetSingle(Endpoints.PostsEndpoint, Id);
    }

    private async Task CreateReply()
    {
        var reply = new ReplyModel
        {
            Id = ReplyModel.Id,
            PostId = PostModel.Id,
            Body = ReplyModel.Body,
            DateReplied = DateTime.UtcNow
        };

        var response = await Http.PostAsJsonAsync($"api/posts/{@PostModel.Id}/reply", reply);
        if(response != null)
        {
            BackToList();
        }
    }

    protected void BackToList()
    {
        NavManager.NavigateTo("/posts/");
    }

}